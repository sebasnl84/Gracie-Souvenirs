<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Categor√≠a - Gracie Souvenirs" id="metaDescription">
    <meta name="keywords" content="souvenirs artesanales, figuras de yeso, velas artesanales">
    <title>Categor√≠a | Gracie Souvenirs</title>
    
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/categoria.css">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="header-container">
            <a href="index.html" style="text-decoration: none;">
                <div class="logo-container">
                    <div class="logo"><img src="images/logo.png" alt="Gracie Souvenirs Logo"></div>
                    <div>
                        <div class="logo-text">Gracie Souvenirs</div>
                        <div class="logo-subtitle">Artesan√≠as con amor</div>
                    </div>
                </div>
            </a>
            <nav>
                <ul>
                    <li><a href="index.html">Inicio</a></li>
                    <li><a href="index.html#eventos">Eventos</a></li>
                    <li><a href="index.html#religiosos">Religiosos</a></li>
                    <li><a href="index.html#decorativos">Decorativos</a></li>
                    <li><a href="index.html#infantil">Infantil</a></li>
                    <li><a href="index.html#naturaleza">Naturaleza</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Breadcrumbs -->
    <div class="breadcrumbs" id="breadcrumbs"></div>

    <!-- Category Header -->
    <section class="category-header" id="categoryHeader" style="display: none;"></section>

    <div id="loadingState" class="loading">Cargando productos...</div>
    <div id="errorState" class="error-message" style="display: none;"></div>

    <!-- Products Grid -->
    <div class="products-container" id="productsContainer" style="display: none;">
        <div class="products-count" id="productsCount"></div>
        <div class="products-grid" id="productsGrid"></div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>M√©todos de Pago y Env√≠os</h3>
                <p>üí≥ Efectivo</p>
                <p>üí≥ Transferencia bancaria</p>
                <p>üì¶ Env√≠os a todo el pa√≠s</p>
                <p>üöö Retiro en Malvinas Argentinas</p>
                <p>üìç Malvinas Argentinas, GBA Norte, Argentina</p>
            </div>
            <div class="footer-section">
                <h3>Contacto</h3>
                <p>üì± WhatsApp: <a href="https://wa.me/5491161486521">+54 9 11 6148-6521</a></p>
                <p>‚úâÔ∏è Consultas por WhatsApp</p>
                <div class="social-links">
                    <a href="https://www.facebook.com/share/1AD6fHpaRF/" target="_blank" title="Facebook">üìò</a>
                    <a href="https://wa.me/5491161486521" target="_blank" title="WhatsApp">üí¨</a>
                </div>
                <p style="margin-top: 1rem; font-style: italic;">Horario de atenci√≥n: Lunes a Viernes 9:00 - 18:00hs</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 Gracie Souvenirs - Todos los derechos reservados | Artesan√≠as hechas con amor</p>
        </div>
    </footer>

    <!-- WhatsApp Float Button -->
    <a href="https://wa.me/5491161486521?text=Hola!%20Quisiera%20consultar%20sobre%20los%20productos" class="whatsapp-float" target="_blank" title="Consultar por WhatsApp"></a>

    <script>
        let categoryProducts = [];
        let productCarousels = {};

        // Obtener el ID de la subcategor√≠a de la URL
        function getSubcategoryFromURL() {
            const params = new URLSearchParams(window.location.search);
            return params.get('cat');
        }

        // Cargar productos de la categor√≠a
        async function loadCategory() {
            const subcategoryId = getSubcategoryFromURL();
            
            if (!subcategoryId) {
                showError('No se especific√≥ una categor√≠a. <a href="index.html">Volver al inicio</a>');
                return;
            }

            try {
                const response = await fetch('products.json');
                const data = await response.json();
                
                const subcategory = data.subcategories[subcategoryId];
                
                if (!subcategory) {
                    showError(`Categor√≠a "${subcategoryId}" no encontrada. <a href="index.html">Volver al inicio</a>`);
                    return;
                }

                // Filtrar productos de esta subcategor√≠a
                const products = data.products.filter(p => p.subcategories.includes(subcategoryId));
                categoryProducts = products;

                renderCategory(subcategory, products, data.categories);
                
            } catch (error) {
                showError('Error al cargar los productos. Por favor, intenta nuevamente.');
                console.error('Error:', error);
            }
        }

        // Mostrar error
        function showError(message) {
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('errorState').innerHTML = message;
            document.getElementById('errorState').style.display = 'block';
        }

        // Renderizar categor√≠a
        function renderCategory(subcategory, products, categories) {
            // Ocultar loading
            document.getElementById('loadingState').style.display = 'none';
            
            // Obtener categor√≠a padre
            const parentCategory = categories[subcategory.parent];

            // Actualizar t√≠tulo y meta
            document.title = `${subcategory.name} | Gracie Souvenirs`;
            document.getElementById('metaDescription').content = subcategory.description;

            // Breadcrumbs
            document.getElementById('breadcrumbs').innerHTML = `
                <a href="index.html">Inicio</a>
                <span>/</span>
                <a href="index.html#${subcategory.parent}">${parentCategory.name}</a>
                <span>/</span>
                <span class="current">${subcategory.name}</span>
            `;

            // Header de categor√≠a
            const headerElement = document.getElementById('categoryHeader');
            headerElement.innerHTML = `
                <div class="category-header-content">
                    <div class="category-icon">${subcategory.icon}</div>
                    <h1>${subcategory.name}</h1>
                    <p>${subcategory.description}</p>
                </div>
            `;
            headerElement.style.display = 'block';

            // Mostrar productos
            document.getElementById('productsContainer').style.display = 'block';
            
            if (products.length === 0) {
                document.getElementById('productsCount').textContent = 'Pr√≥ximamente agregaremos productos a esta categor√≠a';
                document.getElementById('productsGrid').innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <div class="empty-state-icon">üì¶</div>
                        <h2>Pr√≥ximamente</h2>
                        <p>Estamos preparando productos incre√≠bles para esta categor√≠a.</p>
                    </div>
                `;
            } else {
                document.getElementById('productsCount').textContent = 
                    `${products.length} ${products.length === 1 ? 'producto' : 'productos'} disponibles`;
                renderProducts(products);
            }
        }

        // Renderizar productos
        function renderProducts(products) {
            const grid = document.getElementById('productsGrid');
            
            grid.innerHTML = products.map(product => `
                <a href="producto.html?id=${product.id}" class="product-card">
                    <div class="product-image-container" data-product-id="${product.id}">
                        ${product.images.map((img, index) => `
                            <img src="${img}" 
                                 alt="${product.name}" 
                                 class="product-image ${index === 0 ? '' : 'hidden'}" 
                                 data-index="${index}"
                                 onerror="this.style.display='none'; this.parentElement.style.background='linear-gradient(135deg, var(--crema), var(--tierra-claro))';">
                        `).join('')}
                    </div>
                    <div class="product-info">
                        <div class="product-name">${product.name}</div>
                        <div class="product-code">C√≥digo: ${product.id}</div>
                    </div>
                </a>
            `).join('');

            // Iniciar carruseles
            startCarousels();
        }

        // Iniciar carruseles autom√°ticos
        function startCarousels() {
            categoryProducts.forEach(product => {
                if (product.images.length <= 1) return;

                const container = document.querySelector(`[data-product-id="${product.id}"]`);
                if (!container) return;
                
                const images = container.querySelectorAll('.product-image');
                let currentIndex = 0;
                
                productCarousels[product.id] = setInterval(() => {
                    // Ocultar imagen actual
                    images[currentIndex].classList.add('hidden');
                    
                    // Siguiente imagen
                    currentIndex = (currentIndex + 1) % images.length;
                    
                    // Mostrar siguiente imagen
                    images[currentIndex].classList.remove('hidden');
                }, 5000); // Cambiar cada 5 segundos
            });
        }

        // Limpiar intervalos al salir
        window.addEventListener('beforeunload', () => {
            Object.values(productCarousels).forEach(interval => clearInterval(interval));
        });

        // Inicializar
        document.addEventListener('DOMContentLoaded', loadCategory);
    </script>
</body>
</html>